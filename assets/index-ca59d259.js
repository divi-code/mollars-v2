import{s as Oe,g as G,e as x,t as w,l as ke,i as xe,n as ye,o as I,q,j as J,h as P}from"./hub-5742d17f.js";import{B as we,l,b as _e,d as O,P as Pe,T as Ce,D as A,e as z,a as Me,G as $e,x as de,F as ue,s as Le,U as He}from"./misc-d9782c74.js";function Fe(t,e={}){const n=t.method&&t.method.toUpperCase();let i="",a="url";e.customRoute||t.route?(i=e.customRoute||`${t.baseUrl||""}${t.route&&t.route.path}`,a="route"):(t.originalUrl||t.url)&&(i=Oe(t.originalUrl||t.url||""));let r="";return e.method&&n&&(r+=n),e.method&&e.path&&(r+=" "),e.path&&i&&(r+=i),[r,a]}const je=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function ze(t){const e=t.match(je);if(!t||!e)return;let n;return e[3]==="1"?n=!0:e[3]==="0"&&(n=!1),{traceId:e[1],parentSampled:n,parentSpanId:e[2]}}const ee="baggage",Re="sentry-",qe=/^sentry-/,We=8192;function Ve(t){if(!we(t)&&!Array.isArray(t))return;let e={};if(Array.isArray(t))e=t.reduce((i,a)=>{const r=le(a);return{...i,...r}},{});else{if(!t)return;e=le(t)}const n=Object.entries(e).reduce((i,[a,r])=>{if(a.match(qe)){const s=a.slice(Re.length);i[s]=r}return i},{});if(Object.keys(n).length>0)return n}function Ne(t){const e=Object.entries(t).reduce((n,[i,a])=>(a&&(n[`${Re}${i}`]=a),n),{});return Je(e)}function le(t){return t.split(",").map(e=>e.split("=").map(n=>decodeURIComponent(n.trim()))).reduce((e,[n,i])=>(e[n]=i,e),{})}function Je(t){if(Object.keys(t).length!==0)return Object.entries(t).reduce((e,[n,i],a)=>{const r=`${encodeURIComponent(n)}=${encodeURIComponent(i)}`,s=a===0?r:`${e},${r}`;return s.length>We?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn(`Not adding key: ${n} with val: ${i} to baggage header due to exceeding baggage size limits.`),e):s},"")}function ie(t){const e=G().getClient(),n=t||e&&e.getOptions();return!!n&&("tracesSampleRate"in n||"tracesSampler"in n)}function se(t){const n=(t||G()).getScope();return n&&n.getTransaction()}function E(t){return t/1e3}function Xe(){x("error",pe),x("unhandledrejection",pe)}function pe(){const t=se();if(t){const e="internal_error";(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Transaction: ${e} -> Global error occured`),t.setStatus(e)}}class X{__init(){this.spans=[]}constructor(e=1e3){X.prototype.__init.call(this),this._maxlen=e}add(e){this.spans.length>this._maxlen?e.spanRecorder=void 0:this.spans.push(e)}}class R{__init2(){this.traceId=_e()}__init3(){this.spanId=_e().substring(16)}__init4(){this.startTimestamp=w()}__init5(){this.tags={}}__init6(){this.data={}}__init7(){this.instrumenter="sentry"}constructor(e){if(R.prototype.__init2.call(this),R.prototype.__init3.call(this),R.prototype.__init4.call(this),R.prototype.__init5.call(this),R.prototype.__init6.call(this),R.prototype.__init7.call(this),!e)return this;e.traceId&&(this.traceId=e.traceId),e.spanId&&(this.spanId=e.spanId),e.parentSpanId&&(this.parentSpanId=e.parentSpanId),"sampled"in e&&(this.sampled=e.sampled),e.op&&(this.op=e.op),e.description&&(this.description=e.description),e.data&&(this.data=e.data),e.tags&&(this.tags=e.tags),e.status&&(this.status=e.status),e.startTimestamp&&(this.startTimestamp=e.startTimestamp),e.endTimestamp&&(this.endTimestamp=e.endTimestamp),e.instrumenter&&(this.instrumenter=e.instrumenter)}startChild(e){const n=new R({...e,parentSpanId:this.spanId,sampled:this.sampled,traceId:this.traceId});if(n.spanRecorder=this.spanRecorder,n.spanRecorder&&n.spanRecorder.add(n),n.transaction=this.transaction,(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&n.transaction){const i=e&&e.op||"< unknown op >",a=n.transaction.name||"< unknown name >",r=n.transaction.spanId,s=`[Tracing] Starting '${i}' span on transaction '${a}' (${r}).`;n.transaction.metadata.spanMetadata[n.spanId]={logMessage:s},l.log(s)}return n}setTag(e,n){return this.tags={...this.tags,[e]:n},this}setData(e,n){return this.data={...this.data,[e]:n},this}setStatus(e){return this.status=e,this}setHttpStatus(e){this.setTag("http.status_code",String(e));const n=Ke(e);return n!=="unknown_error"&&this.setStatus(n),this}isSuccess(){return this.status==="ok"}finish(e){if((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&this.transaction&&this.transaction.spanId!==this.spanId){const{logMessage:n}=this.transaction.metadata.spanMetadata[this.spanId];n&&l.log(n.replace("Starting","Finishing"))}this.endTimestamp=typeof e=="number"?e:w()}toTraceparent(){let e="";return this.sampled!==void 0&&(e=this.sampled?"-1":"-0"),`${this.traceId}-${this.spanId}${e}`}toContext(){return O({data:this.data,description:this.description,endTimestamp:this.endTimestamp,op:this.op,parentSpanId:this.parentSpanId,sampled:this.sampled,spanId:this.spanId,startTimestamp:this.startTimestamp,status:this.status,tags:this.tags,traceId:this.traceId})}updateWithContext(e){return this.data=e.data||{},this.description=e.description,this.endTimestamp=e.endTimestamp,this.op=e.op,this.parentSpanId=e.parentSpanId,this.sampled=e.sampled,this.spanId=e.spanId||this.spanId,this.startTimestamp=e.startTimestamp||this.startTimestamp,this.status=e.status,this.tags=e.tags||{},this.traceId=e.traceId||this.traceId,this}getTraceContext(){return O({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,trace_id:this.traceId})}toJSON(){return O({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,start_timestamp:this.startTimestamp,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this.endTimestamp,trace_id:this.traceId})}}function Ke(t){if(t<400&&t>=100)return"ok";if(t>=400&&t<500)switch(t){case 401:return"unauthenticated";case 403:return"permission_denied";case 404:return"not_found";case 409:return"already_exists";case 413:return"failed_precondition";case 429:return"resource_exhausted";default:return"invalid_argument"}if(t>=500&&t<600)switch(t){case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline_exceeded";default:return"internal_error"}return"unknown_error"}class U extends R{__init(){this._measurements={}}__init2(){this._contexts={}}__init3(){this._frozenDynamicSamplingContext=void 0}constructor(e,n){super(e),U.prototype.__init.call(this),U.prototype.__init2.call(this),U.prototype.__init3.call(this),this._hub=n||G(),this._name=e.name||"",this.metadata={source:"custom",...e.metadata,spanMetadata:{},changes:[],propagations:0},this._trimEnd=e.trimEnd,this.transaction=this;const i=this.metadata.dynamicSamplingContext;i&&(this._frozenDynamicSamplingContext={...i})}get name(){return this._name}set name(e){this.setName(e)}setName(e,n="custom"){(e!==this.name||n!==this.metadata.source)&&this.metadata.changes.push({source:this.metadata.source,timestamp:ke(),propagations:this.metadata.propagations}),this._name=e,this.metadata.source=n}initSpanRecorder(e=1e3){this.spanRecorder||(this.spanRecorder=new X(e)),this.spanRecorder.add(this)}setContext(e,n){n===null?delete this._contexts[e]:this._contexts[e]=n}setMeasurement(e,n,i=""){this._measurements[e]={value:n,unit:i}}setMetadata(e){this.metadata={...this.metadata,...e}}finish(e){if(this.endTimestamp!==void 0)return;if(this.name||((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this.name="<unlabeled transaction>"),super.finish(e),this.sampled!==!0){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled.");const s=this._hub.getClient();s&&s.recordDroppedEvent("sample_rate","transaction");return}const n=this.spanRecorder?this.spanRecorder.spans.filter(s=>s!==this&&s.endTimestamp):[];this._trimEnd&&n.length>0&&(this.endTimestamp=n.reduce((s,o)=>s.endTimestamp&&o.endTimestamp?s.endTimestamp>o.endTimestamp?s:o:s).endTimestamp);const i=this.metadata,a={contexts:{...this._contexts,trace:this.getTraceContext()},spans:n,start_timestamp:this.startTimestamp,tags:this.tags,timestamp:this.endTimestamp,transaction:this.name,type:"transaction",sdkProcessingMetadata:{...i,dynamicSamplingContext:this.getDynamicSamplingContext()},...i.source&&{transaction_info:{source:i.source,changes:i.changes,propagations:i.propagations}}};return Object.keys(this._measurements).length>0&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding measurements to transaction",JSON.stringify(this._measurements,void 0,2)),a.measurements=this._measurements),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Finishing ${this.op} transaction: ${this.name}.`),this._hub.captureEvent(a)}toContext(){const e=super.toContext();return O({...e,name:this.name,trimEnd:this._trimEnd})}updateWithContext(e){return super.updateWithContext(e),this.name=e.name||"",this._trimEnd=e.trimEnd,this}getDynamicSamplingContext(){if(this._frozenDynamicSamplingContext)return this._frozenDynamicSamplingContext;const e=this._hub||G(),n=e&&e.getClient();if(!n)return{};const{environment:i,release:a}=n.getOptions()||{},{publicKey:r}=n.getDsn()||{},s=this.metadata.sampleRate,o=s!==void 0?s.toString():void 0,c=e.getScope(),{segment:_}=c&&c.getUser()||{},d=this.metadata.source,u=d&&d!=="url"?this.name:void 0;return O({environment:i,release:a,transaction:u,user_segment:_,public_key:r,trace_id:this.traceId,sample_rate:o})}}const be=1e3,De=3e4,Be=5e3;class Qe extends X{constructor(e,n,i,a){super(a),this._pushActivity=e,this._popActivity=n,this.transactionSpanId=i}add(e){e.spanId!==this.transactionSpanId&&(e.finish=n=>{e.endTimestamp=typeof n=="number"?n:w(),this._popActivity(e.spanId)},e.endTimestamp===void 0&&this._pushActivity(e.spanId)),super.add(e)}}class B extends U{__init(){this.activities={}}__init2(){this._heartbeatCounter=0}__init3(){this._finished=!1}__init4(){this._beforeFinishCallbacks=[]}constructor(e,n,i=be,a=De,r=Be,s=!1){super(e,n),this._idleHub=n,this._idleTimeout=i,this._finalTimeout=a,this._heartbeatInterval=r,this._onScope=s,B.prototype.__init.call(this),B.prototype.__init2.call(this),B.prototype.__init3.call(this),B.prototype.__init4.call(this),s&&(fe(n),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`Setting idle transaction on scope. Span ID: ${this.spanId}`),n.configureScope(o=>o.setSpan(this))),this._startIdleTimeout(),setTimeout(()=>{this._finished||(this.setStatus("deadline_exceeded"),this.finish())},this._finalTimeout)}finish(e=w()){if(this._finished=!0,this.activities={},this.spanRecorder){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] finishing IdleTransaction",new Date(e*1e3).toISOString(),this.op);for(const n of this._beforeFinishCallbacks)n(this,e);this.spanRecorder.spans=this.spanRecorder.spans.filter(n=>{if(n.spanId===this.spanId)return!0;n.endTimestamp||(n.endTimestamp=e,n.setStatus("cancelled"),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] cancelling span since transaction ended early",JSON.stringify(n,void 0,2)));const i=n.startTimestamp<e;return i||(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] discarding Span since it happened after Transaction was finished",JSON.stringify(n,void 0,2)),i}),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] flushing IdleTransaction")}else(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] No active IdleTransaction");return this._onScope&&fe(this._idleHub),super.finish(e)}registerBeforeFinishCallback(e){this._beforeFinishCallbacks.push(e)}initSpanRecorder(e){if(!this.spanRecorder){const n=a=>{this._finished||this._pushActivity(a)},i=a=>{this._finished||this._popActivity(a)};this.spanRecorder=new Qe(n,i,this.spanId,e),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("Starting heartbeat"),this._pingHeartbeat()}this.spanRecorder.add(this)}_cancelIdleTimeout(){this._idleTimeoutID&&(clearTimeout(this._idleTimeoutID),this._idleTimeoutID=void 0)}_startIdleTimeout(e){this._cancelIdleTimeout(),this._idleTimeoutID=setTimeout(()=>{!this._finished&&Object.keys(this.activities).length===0&&this.finish(e)},this._idleTimeout)}_pushActivity(e){this._cancelIdleTimeout(),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] pushActivity: ${e}`),this.activities[e]=!0,(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] new activities count",Object.keys(this.activities).length)}_popActivity(e){if(this.activities[e]&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] popActivity ${e}`),delete this.activities[e],(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] new activities count",Object.keys(this.activities).length)),Object.keys(this.activities).length===0){const n=w()+this._idleTimeout/1e3;this._startIdleTimeout(n)}}_beat(){if(this._finished)return;const e=Object.keys(this.activities).join("");e===this._prevHeartbeatString?this._heartbeatCounter++:this._heartbeatCounter=1,this._prevHeartbeatString=e,this._heartbeatCounter>=3?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] Transaction finished because of no change for 3 heart beats"),this.setStatus("deadline_exceeded"),this.finish()):this._pingHeartbeat()}_pingHeartbeat(){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`pinging Heartbeat -> current counter: ${this._heartbeatCounter}`),setTimeout(()=>{this._beat()},this._heartbeatInterval)}}function fe(t){const e=t.getScope();e&&e.getTransaction()&&e.setSpan(void 0)}function Ze(){const t=this.getScope();if(t){const e=t.getSpan();if(e)return{"sentry-trace":e.toTraceparent()}}return{}}function Ue(t,e,n){if(!ie(e))return t.sampled=!1,t;if(t.sampled!==void 0)return t.setMetadata({sampleRate:Number(t.sampled)}),t;let i;return typeof e.tracesSampler=="function"?(i=e.tracesSampler(n),t.setMetadata({sampleRate:Number(i)})):n.parentSampled!==void 0?i=n.parentSampled:(i=e.tracesSampleRate,t.setMetadata({sampleRate:Number(i)})),et(i)?i?(t.sampled=Math.random()<i,t.sampled?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] starting ${t.op} transaction - ${t.name}`),t):((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(i)})`),t)):((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Discarding transaction because ${typeof e.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),t.sampled=!1,t):((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn("[Tracing] Discarding transaction because of invalid sample rate."),t.sampled=!1,t)}function et(t){return Pe(t)||!(typeof t=="number"||typeof t=="boolean")?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(t)} of type ${JSON.stringify(typeof t)}.`),!1):t<0||t>1?((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn(`[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got ${t}.`),!1):!0}function tt(t,e){const n=this.getClient(),i=n&&n.getOptions()||{},a=i.instrumenter||"sentry",r=t.instrumenter||"sentry";a!==r&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error(`A transaction was started with instrumenter=\`${r}\`, but the SDK is configured with the \`${a}\` instrumenter.
The transaction will not be sampled. Please use the ${a} instrumentation to start transactions.`),t.sampled=!1);let s=new U(t,this);return s=Ue(s,i,{parentSampled:t.parentSampled,transactionContext:t,...e}),s.sampled&&s.initSpanRecorder(i._experiments&&i._experiments.maxSpans),s}function he(t,e,n,i,a,r,s){const o=t.getClient(),c=o&&o.getOptions()||{};let _=new B(e,t,n,i,s,a);return _=Ue(_,c,{parentSampled:e.parentSampled,transactionContext:e,...r}),_.sampled&&_.initSpanRecorder(c._experiments&&c._experiments.maxSpans),_}function nt(){const t=ye();t.__SENTRY__&&(t.__SENTRY__.extensions=t.__SENTRY__.extensions||{},t.__SENTRY__.extensions.startTransaction||(t.__SENTRY__.extensions.startTransaction=tt),t.__SENTRY__.extensions.traceHeaders||(t.__SENTRY__.extensions.traceHeaders=Ze))}function it(){const t=ye();if(!t.__SENTRY__)return;const e={mongodb(){const i=q(module,"./integrations/node/mongo");return new i.Mongo},mongoose(){const i=q(module,"./integrations/node/mongo");return new i.Mongo({mongoose:!0})},mysql(){const i=q(module,"./integrations/node/mysql");return new i.Mysql},pg(){const i=q(module,"./integrations/node/postgres");return new i.Postgres}},n=Object.keys(e).filter(i=>!!I(i)).map(i=>{try{return e[i]()}catch{return}}).filter(i=>i);n.length>0&&(t.__SENTRY__.integrations=[...t.__SENTRY__.integrations||[],...n])}function st(){nt(),xe()&&it(),Xe()}function f(t){let e,n=t[0],i=1;for(;i<t.length;){const a=t[i],r=t[i+1];if(i+=2,(a==="optionalAccess"||a==="optionalCall")&&n==null)return;a==="access"||a==="optionalAccess"?(e=n,n=r(n)):(a==="call"||a==="optionalCall")&&(n=r((...s)=>n.call(e,...s)),e=void 0)}return n}function b(t){const e=f([t,"call",i=>i(),"access",i=>i.getClient,"call",i=>i(),"optionalAccess",i=>i.getOptions,"call",i=>i()]);return(f([e,"optionalAccess",i=>i.instrumenter])||"sentry")!=="sentry"}class C{static __initStatic(){this.id="Express"}__init(){this.name=C.id}constructor(e={}){C.prototype.__init.call(this),this._router=e.router||e.app,this._methods=(Array.isArray(e.methods)?e.methods:[]).concat("use")}setupOnce(e,n){if(!this._router){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error("ExpressIntegration is missing an Express instance");return}if(b(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("Express Integration is skipped because of instrumenter configuration.");return}ot(this._router,this._methods),ct(this._router)}}C.__initStatic();function me(t,e){const n=t.length;switch(n){case 2:return function(i,a){const r=a.__sentry_transaction;if(r){const s=r.startChild({description:t.name,op:`middleware.express.${e}`});a.once("finish",()=>{s.finish()})}return t.call(this,i,a)};case 3:return function(i,a,r){const s=a.__sentry_transaction,o=f([s,"optionalAccess",c=>c.startChild,"call",c=>c({description:t.name,op:`middleware.express.${e}`})]);t.call(this,i,a,function(...c){f([o,"optionalAccess",_=>_.finish,"call",_=>_()]),r.call(this,...c)})};case 4:return function(i,a,r,s){const o=r.__sentry_transaction,c=f([o,"optionalAccess",_=>_.startChild,"call",_=>_({description:t.name,op:`middleware.express.${e}`})]);t.call(this,i,a,r,function(..._){f([c,"optionalAccess",d=>d.finish,"call",d=>d()]),s.call(this,..._)})};default:throw new Error(`Express middleware takes 2-4 arguments. Got: ${n}`)}}function at(t,e){return t.map(n=>typeof n=="function"?me(n,e):Array.isArray(n)?n.map(i=>typeof i=="function"?me(i,e):i):n)}function rt(t,e){const n=t[e];return t[e]=function(...i){return n.call(this,...at(i,e))},t}function ot(t,e=[]){e.forEach(n=>rt(t,n))}function ct(t){const e="settings"in t;e&&t._router===void 0&&t.lazyrouter&&t.lazyrouter();const n=e?t._router:t;if(!n){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.debug("Cannot instrument router for URL Parameterization (did not find a valid router)."),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.debug("Routing instrumentation is currently only supported in Express 4.");return}const i=Object.getPrototypeOf(n),a=i.process_params;i.process_params=function(s,o,c,_,d){c._reconstructedRoute||(c._reconstructedRoute="");const{layerRoutePath:u,isRegex:h,isArray:p,numExtraSegments:m}=_t(s);(u||h||p)&&(c._hasParameters=!0);const N=(u||s.path||"").split("/").filter(D=>D.length>0&&(h||p||!D.includes("*"))).join("/");N&&N.length>0&&(c._reconstructedRoute+=`/${N}${h?"/":""}`);const Y=J(c.originalUrl||"")+m,Ae=J(c._reconstructedRoute);if(Y===Ae){c._hasParameters||c._reconstructedRoute!==c.originalUrl&&(c._reconstructedRoute=c.originalUrl);const D=_.__sentry_transaction;if(D&&D.metadata.source!=="custom"){const Ye=c._reconstructedRoute||"/";D.setName(...Fe(c,{path:!0,method:!0,customRoute:Ye}))}}return a.call(this,s,o,c,_,d)}}function _t(t){const e=f([t,"access",s=>s.route,"optionalAccess",s=>s.path]),n=Ce(e),i=Array.isArray(e);if(!e)return{isRegex:n,isArray:i,numExtraSegments:0};const a=i?Math.max(dt(e)-J(t.path||""),0):0;return{layerRoutePath:ut(i,e),isRegex:n,isArray:i,numExtraSegments:a}}function dt(t){return t.reduce((e,n)=>e+J(n.toString()),0)}function ut(t,e){return t?e.map(n=>n.toString()).join(","):e&&e.toString()}class M{static __initStatic(){this.id="Postgres"}__init(){this.name=M.id}constructor(e={}){M.prototype.__init.call(this),this._usePgNative=!!e.usePgNative}setupOnce(e,n){if(b(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("Postgres Integration is skipped because of instrumenter configuration.");return}const i=I("pg");if(!i){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error("Postgres Integration was unable to require `pg` package.");return}if(this._usePgNative&&!f([i,"access",r=>r.native,"optionalAccess",r=>r.Client])){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error("Postgres Integration was unable to access 'pg-native' bindings.");return}const{Client:a}=this._usePgNative?i.native:i;A(a.prototype,"query",function(r){return function(s,o,c){const _=n().getScope(),d=f([_,"optionalAccess",p=>p.getSpan,"call",p=>p()]),u=f([d,"optionalAccess",p=>p.startChild,"call",p=>p({description:typeof s=="string"?s:s.text,op:"db"})]);if(typeof c=="function")return r.call(this,s,o,function(p,m){f([u,"optionalAccess",S=>S.finish,"call",S=>S()]),c(p,m)});if(typeof o=="function")return r.call(this,s,function(p,m){f([u,"optionalAccess",S=>S.finish,"call",S=>S()]),o(p,m)});const h=typeof o<"u"?r.call(this,s,o):r.call(this,s);return z(h)?h.then(p=>(f([u,"optionalAccess",m=>m.finish,"call",m=>m()]),p)):(f([u,"optionalAccess",p=>p.finish,"call",p=>p()]),h)}})}}M.__initStatic();class ${constructor(){$.prototype.__init.call(this)}static __initStatic(){this.id="Mysql"}__init(){this.name=$.id}setupOnce(e,n){if(b(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("Mysql Integration is skipped because of instrumenter configuration.");return}const i=I("mysql/lib/Connection.js");if(!i){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error("Mysql Integration was unable to require `mysql` package.");return}A(i,"createQuery",function(a){return function(r,s,o){const c=n().getScope(),_=f([c,"optionalAccess",u=>u.getSpan,"call",u=>u()]),d=f([_,"optionalAccess",u=>u.startChild,"call",u=>u({description:typeof r=="string"?r:r.sql,op:"db"})]);return typeof o=="function"?a.call(this,r,s,function(u,h,p){f([d,"optionalAccess",m=>m.finish,"call",m=>m()]),o(u,h,p)}):typeof s=="function"?a.call(this,r,function(u,h,p){f([d,"optionalAccess",m=>m.finish,"call",m=>m()]),s(u,h,p)}):a.call(this,r,s,o)}})}}$.__initStatic();const lt=["aggregate","bulkWrite","countDocuments","createIndex","createIndexes","deleteMany","deleteOne","distinct","drop","dropIndex","dropIndexes","estimatedDocumentCount","find","findOne","findOneAndDelete","findOneAndReplace","findOneAndUpdate","indexes","indexExists","indexInformation","initializeOrderedBulkOp","insertMany","insertOne","isCapped","mapReduce","options","parallelCollectionScan","rename","replaceOne","stats","updateMany","updateOne"],pt={bulkWrite:["operations"],countDocuments:["query"],createIndex:["fieldOrSpec"],createIndexes:["indexSpecs"],deleteMany:["filter"],deleteOne:["filter"],distinct:["key","query"],dropIndex:["indexName"],find:["query"],findOne:["query"],findOneAndDelete:["filter"],findOneAndReplace:["filter","replacement"],findOneAndUpdate:["filter","update"],indexExists:["indexes"],insertMany:["docs"],insertOne:["doc"],mapReduce:["map","reduce"],rename:["newName"],replaceOne:["filter","doc"],updateMany:["filter","update"],updateOne:["filter","update"]};function ft(t){return t&&typeof t=="object"&&t.once&&typeof t.once=="function"}class L{static __initStatic(){this.id="Mongo"}__init(){this.name=L.id}constructor(e={}){L.prototype.__init.call(this),this._operations=Array.isArray(e.operations)?e.operations:lt,this._describeOperations="describeOperations"in e?e.describeOperations:!0,this._useMongoose=!!e.useMongoose}setupOnce(e,n){if(b(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("Mongo Integration is skipped because of instrumenter configuration.");return}const i=this._useMongoose?"mongoose":"mongodb",a=I(i);if(!a){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error(`Mongo Integration was unable to require \`${i}\` package.`);return}this._instrumentOperations(a.Collection,this._operations,n)}_instrumentOperations(e,n,i){n.forEach(a=>this._patchOperation(e,a,i))}_patchOperation(e,n,i){if(!(n in e.prototype))return;const a=this._getSpanContextFromOperationArguments.bind(this);A(e.prototype,n,function(r){return function(...s){const o=s[s.length-1],c=i().getScope(),_=f([c,"optionalAccess",u=>u.getSpan,"call",u=>u()]);if(typeof o!="function"||n==="mapReduce"&&s.length===2){const u=f([_,"optionalAccess",p=>p.startChild,"call",p=>p(a(this,n,s))]),h=r.call(this,...s);if(z(h))return h.then(p=>(f([u,"optionalAccess",m=>m.finish,"call",m=>m()]),p));if(ft(h)){const p=h;try{p.once("close",()=>{f([u,"optionalAccess",m=>m.finish,"call",m=>m()])})}catch{f([u,"optionalAccess",S=>S.finish,"call",S=>S()])}return p}else return f([u,"optionalAccess",p=>p.finish,"call",p=>p()]),h}const d=f([_,"optionalAccess",u=>u.startChild,"call",u=>u(a(this,n,s.slice(0,-1)))]);return r.call(this,...s.slice(0,-1),function(u,h){f([d,"optionalAccess",p=>p.finish,"call",p=>p()]),o(u,h)})}})}_getSpanContextFromOperationArguments(e,n,i){const a={collectionName:e.collectionName,dbName:e.dbName,namespace:e.namespace},r={op:"db",description:n,data:a},s=pt[n],o=Array.isArray(this._describeOperations)?this._describeOperations.includes(n):this._describeOperations;if(!s||!o)return r;try{if(n==="mapReduce"){const[c,_]=i;a[s[0]]=typeof c=="string"?c:c.name||"<anonymous>",a[s[1]]=typeof _=="string"?_:_.name||"<anonymous>"}else for(let c=0;c<s.length;c++)a[s[c]]=JSON.stringify(i[c])}catch{}return r}}L.__initStatic();function ht(t){return t&&!!t.$use}class H{static __initStatic(){this.id="Prisma"}__init(){this.name=H.id}constructor(e={}){H.prototype.__init.call(this),ht(e.client)?this._client=e.client:(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn(`Unsupported Prisma client provided to PrismaIntegration. Provided client: ${JSON.stringify(e.client)}`)}setupOnce(e,n){if(!this._client){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error("PrismaIntegration is missing a Prisma Client Instance");return}if(b(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("Prisma Integration is skipped because of instrumenter configuration.");return}this._client.$use((i,a)=>{const r=n().getScope(),s=f([r,"optionalAccess",u=>u.getSpan,"call",u=>u()]),o=i.action,c=i.model,_=f([s,"optionalAccess",u=>u.startChild,"call",u=>u({description:c?`${c} ${o}`:o,op:"db.sql.prisma"})]),d=a(i);return z(d)?d.then(u=>(f([_,"optionalAccess",h=>h.finish,"call",h=>h()]),u)):(f([_,"optionalAccess",u=>u.finish,"call",u=>u()]),d)})}}H.__initStatic();class F{constructor(){F.prototype.__init.call(this)}static __initStatic(){this.id="GraphQL"}__init(){this.name=F.id}setupOnce(e,n){if(b(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("GraphQL Integration is skipped because of instrumenter configuration.");return}const i=I("graphql/execution/execute.js");if(!i){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error("GraphQL Integration was unable to require graphql/execution package.");return}A(i,"execute",function(a){return function(...r){const s=n().getScope(),o=f([s,"optionalAccess",d=>d.getSpan,"call",d=>d()]),c=f([o,"optionalAccess",d=>d.startChild,"call",d=>d({description:"execute",op:"graphql.execute"})]);f([s,"optionalAccess",d=>d.setSpan,"call",d=>d(c)]);const _=a.call(this,...r);return z(_)?_.then(d=>(f([c,"optionalAccess",u=>u.finish,"call",u=>u()]),f([s,"optionalAccess",u=>u.setSpan,"call",u=>u(o)]),d)):(f([c,"optionalAccess",d=>d.finish,"call",d=>d()]),f([s,"optionalAccess",d=>d.setSpan,"call",d=>d(o)]),_)}})}}F.__initStatic();class j{constructor(){j.prototype.__init.call(this)}static __initStatic(){this.id="Apollo"}__init(){this.name=j.id}setupOnce(e,n){if(b(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("Apollo Integration is skipped because of instrumenter configuration.");return}const i=I("apollo-server-core");if(!i){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.error("Apollo Integration was unable to require apollo-server-core package.");return}A(i.ApolloServerBase.prototype,"constructSchema",function(a){return function(){if(!this.config.resolvers)return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&(this.config.schema?l.warn("Apollo integration is not able to trace `ApolloServer` instances constructed via `schema` property."):this.config.modules&&l.warn("Apollo integration is not able to trace `ApolloServer` instances constructed via `modules` property."),l.error("Skipping tracing as no resolvers found on the `ApolloServer` instance.")),a.call(this);const r=Me(this.config.resolvers);return this.config.resolvers=r.map(s=>(Object.keys(s).forEach(o=>{Object.keys(s[o]).forEach(c=>{typeof s[o][c]=="function"&&mt(s,o,c,n)})}),s)),a.call(this)}})}}j.__initStatic();function mt(t,e,n,i){A(t[e],n,function(a){return function(...r){const s=i().getScope(),o=f([s,"optionalAccess",d=>d.getSpan,"call",d=>d()]),c=f([o,"optionalAccess",d=>d.startChild,"call",d=>d({description:`${e}.${n}`,op:"graphql.resolve"})]),_=a.call(this,...r);return z(_)?_.then(d=>(f([c,"optionalAccess",u=>u.finish,"call",u=>u()]),d)):(f([c,"optionalAccess",d=>d.finish,"call",d=>d()]),_)}})}const g=$e;function gt(){g&&g.document?g.document.addEventListener("visibilitychange",()=>{const t=se();if(g.document.hidden&&t){const e="cancelled";(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Transaction: ${e} -> since tab moved to the background, op: ${t.op}`),t.status||t.setStatus(e),t.setTag("visibilitychange","document.hidden"),t.finish()}}):(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn("[Tracing] Could not set up background tab detection due to lack of global document")}const ae=(t,e,n)=>{let i,a;return r=>{e.value>=0&&(r||n)&&(a=e.value-(i||0),(a||i===void 0)&&(i=e.value,e.delta=a,t(e)))}},Tt=()=>`v3-${Date.now()}-${Math.floor(Math.random()*(9e12-1))+1e12}`,Et=()=>{const t=g.performance.timing,e=g.performance.navigation.type,n={entryType:"navigation",startTime:0,type:e==2?"back_forward":e===1?"reload":"navigate"};for(const i in t)i!=="navigationStart"&&i!=="toJSON"&&(n[i]=Math.max(t[i]-t.navigationStart,0));return n},Ge=()=>g.__WEB_VITALS_POLYFILL__?g.performance&&(performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]||Et()):g.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0],ve=()=>{const t=Ge();return t&&t.activationStart||0},re=(t,e)=>{const n=Ge();let i="navigate";return n&&(g.document.prerendering||ve()>0?i="prerender":i=n.type.replace(/_/g,"-")),{name:t,value:typeof e>"u"?-1:e,rating:"good",delta:0,entries:[],id:Tt(),navigationType:i}},K=(t,e,n)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const i=new PerformanceObserver(a=>{e(a.getEntries())});return i.observe(Object.assign({type:t,buffered:!0},n||{})),i}}catch{}},Q=(t,e)=>{const n=i=>{(i.type==="pagehide"||g.document.visibilityState==="hidden")&&(t(i),e&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},St=t=>{const e=re("CLS",0);let n,i=0,a=[];const r=o=>{o.forEach(c=>{if(!c.hadRecentInput){const _=a[0],d=a[a.length-1];i&&a.length!==0&&c.startTime-d.startTime<1e3&&c.startTime-_.startTime<5e3?(i+=c.value,a.push(c)):(i=c.value,a=[c]),i>e.value&&(e.value=i,e.entries=a,n&&n())}})},s=K("layout-shift",r);s&&(n=ae(t,e),Q(()=>{r(s.takeRecords()),n(!0)}))};let V=-1;const yt=()=>g.document.visibilityState==="hidden"&&!g.document.prerendering?0:1/0,Rt=()=>{Q(({timeStamp:t})=>{V=t},!0)},oe=()=>(V<0&&(V=yt(),Rt()),{get firstHiddenTime(){return V}}),Nt=t=>{const e=oe(),n=re("FID");let i;const a=o=>{o.startTime<e.firstHiddenTime&&(n.value=o.processingStart-o.startTime,n.entries.push(o),i(!0))},r=o=>{o.forEach(a)},s=K("first-input",r);i=ae(t,n),s&&Q(()=>{r(s.takeRecords()),s.disconnect()},!0)},ge={},bt=t=>{const e=oe(),n=re("LCP");let i;const a=s=>{const o=s[s.length-1];if(o){const c=Math.max(o.startTime-ve(),0);c<e.firstHiddenTime&&(n.value=c,n.entries=[o],i())}},r=K("largest-contentful-paint",a);if(r){i=ae(t,n);const s=()=>{ge[n.id]||(a(r.takeRecords()),r.disconnect(),ge[n.id]=!0,i(!0))};["keydown","click"].forEach(o=>{addEventListener(o,s,{once:!0,capture:!0})}),Q(s,!0)}};function Z(t){return typeof t=="number"&&isFinite(t)}function v(t,{startTimestamp:e,...n}){return e&&t.startTimestamp>e&&(t.startTimestamp=e),t.startChild({startTimestamp:e,...n})}function Ie(){return g&&g.addEventListener&&g.performance}let Te=0,T={},y,k;function Dt(){const t=Ie();t&&P&&(t.mark&&g.performance.mark("sentry-tracing-init"),Ut(),Gt(),vt())}function Bt(){K("longtask",e=>{for(const n of e){const i=se();if(!i)return;const a=E(P+n.startTime),r=E(n.duration);i.startChild({description:"Main UI thread blocked",op:"ui.long-task",startTimestamp:a,endTimestamp:a+r})}})}function Ut(){St(t=>{const e=t.entries.pop();e&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding CLS"),T.cls={value:t.value,unit:""},k=e)})}function Gt(){bt(t=>{const e=t.entries.pop();e&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding LCP"),T.lcp={value:t.value,unit:"millisecond"},y=e)})}function vt(){Nt(t=>{const e=t.entries.pop();if(!e)return;const n=E(P),i=E(e.startTime);(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding FID"),T.fid={value:t.value,unit:"millisecond"},T["mark.fid"]={value:n+i,unit:"second"}})}function It(t){const e=Ie();if(!e||!g.performance.getEntries||!P)return;(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Tracing] Adding & adjusting spans using Performance API");const n=E(P),i=e.getEntries();let a,r;if(i.slice(Te).forEach(s=>{const o=E(s.startTime),c=E(s.duration);if(!(t.op==="navigation"&&n+o<t.startTimestamp))switch(s.entryType){case"navigation":{Yt(t,s,n),a=n+E(s.responseStart),r=n+E(s.requestStart);break}case"mark":case"paint":case"measure":{At(t,s,o,c,n);const _=oe(),d=s.startTime<_.firstHiddenTime;s.name==="first-paint"&&d&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding FP"),T.fp={value:s.startTime,unit:"millisecond"}),s.name==="first-contentful-paint"&&d&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding FCP"),T.fcp={value:s.startTime,unit:"millisecond"});break}case"resource":{const _=s.name.replace(g.location.origin,"");kt(t,s,_,o,c,n);break}}}),Te=Math.max(i.length-1,0),xt(t),t.op==="pageload"){typeof a=="number"&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding TTFB"),T.ttfb={value:(a-t.startTimestamp)*1e3,unit:"millisecond"},typeof r=="number"&&r<=a&&(T["ttfb.requestTime"]={value:(a-r)*1e3,unit:"millisecond"})),["fcp","fp","lcp"].forEach(o=>{if(!T[o]||n>=t.startTimestamp)return;const c=T[o].value,_=n+E(c),d=Math.abs((_-t.startTimestamp)*1e3),u=d-c;(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Measurements] Normalized ${o} from ${c} to ${d} (${u})`),T[o].value=d});const s=T["mark.fid"];s&&T.fid&&(v(t,{description:"first input delay",endTimestamp:s.value+E(T.fid.value),op:"ui.action",startTimestamp:s.value}),delete T["mark.fid"]),"fcp"in T||delete T.cls,Object.keys(T).forEach(o=>{t.setMeasurement(o,T[o].value,T[o].unit)}),wt(t)}y=void 0,k=void 0,T={}}function At(t,e,n,i,a){const r=a+n,s=r+i;return v(t,{description:e.name,endTimestamp:s,op:e.entryType,startTimestamp:r}),r}function Yt(t,e,n){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach(i=>{W(t,e,i,n)}),W(t,e,"secureConnection",n,"TLS/SSL","connectEnd"),W(t,e,"fetch",n,"cache","domainLookupStart"),W(t,e,"domainLookup",n,"DNS"),Ot(t,e,n)}function W(t,e,n,i,a,r){const s=r?e[r]:e[`${n}End`],o=e[`${n}Start`];!o||!s||v(t,{op:"browser",description:a||n,startTimestamp:i+E(o),endTimestamp:i+E(s)})}function Ot(t,e,n){v(t,{op:"browser",description:"request",startTimestamp:n+E(e.requestStart),endTimestamp:n+E(e.responseEnd)}),v(t,{op:"browser",description:"response",startTimestamp:n+E(e.responseStart),endTimestamp:n+E(e.responseEnd)})}function kt(t,e,n,i,a,r){if(e.initiatorType==="xmlhttprequest"||e.initiatorType==="fetch")return;const s={};"transferSize"in e&&(s["Transfer Size"]=e.transferSize),"encodedBodySize"in e&&(s["Encoded Body Size"]=e.encodedBodySize),"decodedBodySize"in e&&(s["Decoded Body Size"]=e.decodedBodySize);const o=r+i,c=o+a;v(t,{description:n,endTimestamp:c,op:e.initiatorType?`resource.${e.initiatorType}`:"resource.other",startTimestamp:o,data:s})}function xt(t){const e=g.navigator;if(!e)return;const n=e.connection;n&&(n.effectiveType&&t.setTag("effectiveConnectionType",n.effectiveType),n.type&&t.setTag("connectionType",n.type),Z(n.rtt)&&(T["connection.rtt"]={value:n.rtt,unit:"millisecond"})),Z(e.deviceMemory)&&t.setTag("deviceMemory",`${e.deviceMemory} GB`),Z(e.hardwareConcurrency)&&t.setTag("hardwareConcurrency",String(e.hardwareConcurrency))}function wt(t){y&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding LCP Data"),y.element&&t.setTag("lcp.element",de(y.element)),y.id&&t.setTag("lcp.id",y.id),y.url&&t.setTag("lcp.url",y.url.trim().slice(0,200)),t.setTag("lcp.size",y.size)),k&&k.sources&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log("[Measurements] Adding CLS Data"),k.sources.forEach((e,n)=>t.setTag(`cls.source.${n+1}`,de(e.node))))}const te=["localhost",/^\//],ne={traceFetch:!0,traceXHR:!0,tracingOrigins:te,tracePropagationTargets:te};function Pt(t){const{traceFetch:e,traceXHR:n,tracePropagationTargets:i,tracingOrigins:a,shouldCreateSpanForRequest:r}={traceFetch:ne.traceFetch,traceXHR:ne.traceXHR,...t},s=typeof r=="function"?r:_=>!0,o=_=>Ct(_,i||a),c={};e&&x("fetch",_=>{Mt(_,s,o,c)}),n&&x("xhr",_=>{Lt(_,s,o,c)})}function Ct(t,e){return Le(t,e||te)}function Mt(t,e,n,i){if(!ie()||!(t.fetchData&&e(t.fetchData.url)))return;if(t.endTimestamp){const o=t.fetchData.__span;if(!o)return;const c=i[o];c&&(t.response?c.setHttpStatus(t.response.status):t.error&&c.setStatus("internal_error"),c.finish(),delete i[o]);return}const a=G().getScope(),r=a&&a.getSpan(),s=r&&r.transaction;if(r&&s){const o=r.startChild({data:{...t.fetchData,type:"fetch"},description:`${t.fetchData.method} ${t.fetchData.url}`,op:"http.client"});t.fetchData.__span=o.spanId,i[o.spanId]=o;const c=t.args[0];t.args[1]=t.args[1]||{};const _=t.args[1];n(t.fetchData.url)&&(_.headers=$t(c,s.getDynamicSamplingContext(),o,_),s.metadata.propagations++)}}function $t(t,e,n,i){const a=Ne(e),r=n.toTraceparent(),s=typeof Request<"u"&&ue(t,Request)?t.headers:i.headers;if(s)if(typeof Headers<"u"&&ue(s,Headers)){const o=new Headers(s);return o.append("sentry-trace",r),a&&o.append(ee,a),o}else if(Array.isArray(s)){const o=[...s,["sentry-trace",r]];return a&&o.push([ee,a]),o}else{const o="baggage"in s?s.baggage:void 0,c=[];return Array.isArray(o)?c.push(...o):o&&c.push(o),a&&c.push(a),{...s,"sentry-trace":r,baggage:c.length>0?c.join(","):void 0}}else return{"sentry-trace":r,baggage:a}}function Lt(t,e,n,i){if(!ie()||t.xhr&&t.xhr.__sentry_own_request__||!(t.xhr&&t.xhr.__sentry_xhr__&&e(t.xhr.__sentry_xhr__.url)))return;const a=t.xhr.__sentry_xhr__;if(t.endTimestamp){const c=t.xhr.__sentry_xhr_span_id__;if(!c)return;const _=i[c];_&&(_.setHttpStatus(a.status_code),_.finish(),delete i[c]);return}const r=G().getScope(),s=r&&r.getSpan(),o=s&&s.transaction;if(s&&o){const c=s.startChild({data:{...a.data,type:"xhr",method:a.method,url:a.url},description:`${a.method} ${a.url}`,op:"http.client"});if(t.xhr.__sentry_xhr_span_id__=c.spanId,i[t.xhr.__sentry_xhr_span_id__]=c,t.xhr.setRequestHeader&&n(t.xhr.__sentry_xhr__.url))try{t.xhr.setRequestHeader("sentry-trace",c.toTraceparent());const _=o.getDynamicSamplingContext(),d=Ne(_);d&&t.xhr.setRequestHeader(ee,d),o.metadata.propagations++}catch{}}}function Ht(t,e=!0,n=!0){if(!g||!g.location){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn("Could not initialize routing instrumentation due to invalid location");return}let i=g.location.href,a;e&&(a=t({name:g.location.pathname,op:"pageload",metadata:{source:"url"}})),n&&x("history",({to:r,from:s})=>{if(s===void 0&&i&&i.indexOf(r)!==-1){i=void 0;return}s!==r&&(i=void 0,a&&((typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Finishing current transaction with op: ${a.op}`),a.finish()),a=t({name:g.location.pathname,op:"navigation",metadata:{source:"url"}}))})}const Ft="BrowserTracing",jt={idleTimeout:be,finalTimeout:De,heartbeatInterval:Be,markBackgroundTransactions:!0,routingInstrumentation:Ht,startTransactionOnLocationChange:!0,startTransactionOnPageLoad:!0,enableLongTask:!0,_experiments:{},...ne};class ce{__init(){this.name=Ft}constructor(e){ce.prototype.__init.call(this),this.options={...jt,...e},this.options._experiments.enableLongTask!==void 0&&(this.options.enableLongTask=this.options._experiments.enableLongTask),e&&!e.tracePropagationTargets&&e.tracingOrigins&&(this.options.tracePropagationTargets=e.tracingOrigins),Dt(),this.options.enableLongTask&&Bt()}setupOnce(e,n){this._getCurrentHub=n;const{routingInstrumentation:i,startTransactionOnLocationChange:a,startTransactionOnPageLoad:r,markBackgroundTransactions:s,traceFetch:o,traceXHR:c,tracePropagationTargets:_,shouldCreateSpanForRequest:d,_experiments:u}=this.options;i(h=>this._createRouteTransaction(h),r,a),s&&gt(),u.enableInteractions&&this._registerInteractionListener(),Pt({traceFetch:o,traceXHR:c,tracePropagationTargets:_,shouldCreateSpanForRequest:d})}_createRouteTransaction(e){if(!this._getCurrentHub){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn(`[Tracing] Did not create ${e.op} transaction because _getCurrentHub is invalid.`);return}const{beforeNavigate:n,idleTimeout:i,finalTimeout:a,heartbeatInterval:r}=this.options,s=e.op==="pageload",o=s?Ee("sentry-trace"):null,c=s?Ee("baggage"):null,_=o?ze(o):void 0,d=c?Ve(c):void 0,u={...e,..._,metadata:{...e.metadata,dynamicSamplingContext:_&&!d?{}:d},trimEnd:!0},h=typeof n=="function"?n(u):u,p=h===void 0?{...u,sampled:!1}:h;p.metadata=p.name!==u.name?{...p.metadata,source:"custom"}:p.metadata,this._latestRouteName=p.name,this._latestRouteSource=p.metadata&&p.metadata.source,p.sampled===!1&&(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Will not send ${p.op} transaction because of beforeNavigate.`),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.log(`[Tracing] Starting ${p.op} transaction on scope`);const m=this._getCurrentHub(),{location:S}=g,N=he(m,p,i,a,!0,{location:S},r);return N.registerBeforeFinishCallback(Y=>{It(Y)}),N}_registerInteractionListener(){let e;const n=()=>{const{idleTimeout:i,finalTimeout:a,heartbeatInterval:r}=this.options,s="ui.action.click";if(e&&(e.finish(),e=void 0),!this._getCurrentHub){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn(`[Tracing] Did not create ${s} transaction because _getCurrentHub is invalid.`);return}if(!this._latestRouteName){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&l.warn(`[Tracing] Did not create ${s} transaction because _latestRouteName is missing.`);return}const o=this._getCurrentHub(),{location:c}=g,_={name:this._latestRouteName,op:s,trimEnd:!0,metadata:{source:this._latestRouteSource||"url"}};e=he(o,_,i,a,!0,{location:c},r)};["click"].forEach(i=>{addEventListener(i,n,{once:!1,capture:!0})})}}function Ee(t){const e=He(`meta[name=${t}]`);return e?e.getAttribute("content"):null}const Wt=Object.freeze(Object.defineProperty({__proto__:null,Apollo:j,BrowserTracing:ce,Express:C,GraphQL:F,Mongo:L,Mysql:$,Postgres:M,Prisma:H},Symbol.toStringTag,{value:"Module"}));var Se;(function(t){const e="ok";t.Ok=e;const n="deadline_exceeded";t.DeadlineExceeded=n;const i="unauthenticated";t.Unauthenticated=i;const a="permission_denied";t.PermissionDenied=a;const r="not_found";t.NotFound=r;const s="resource_exhausted";t.ResourceExhausted=s;const o="invalid_argument";t.InvalidArgument=o;const c="unimplemented";t.Unimplemented=c;const _="unavailable";t.Unavailable=_;const d="internal_error";t.InternalError=d;const u="unknown_error";t.UnknownError=u;const h="cancelled";t.Cancelled=h;const p="already_exists";t.AlreadyExists=p;const m="failed_precondition";t.FailedPrecondition=m;const S="aborted";t.Aborted=S;const N="out_of_range";t.OutOfRange=N;const Y="data_loss";t.DataLoss=Y})(Se||(Se={}));(typeof __SENTRY_TRACING__>"u"||__SENTRY_TRACING__)&&st();export{Ft as BROWSER_TRACING_INTEGRATION_ID,ce as BrowserTracing,B as IdleTransaction,Wt as Integrations,R as Span,Se as SpanStatus,je as TRACEPARENT_REGEXP,U as Transaction,st as addExtensionMethods,ne as defaultRequestInstrumentationOptions,ze as extractTraceparentData,se as getActiveTransaction,ie as hasTracingEnabled,Pt as instrumentOutgoingRequests,Ke as spanStatusfromHttpCode,he as startIdleTransaction,Oe as stripUrlQueryAndFragment};
